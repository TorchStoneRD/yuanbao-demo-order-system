# 二八槓內部API文件

# 文件目的
  - 本文檔定義二八槓內部API進出參規範,並提供範例格式.


# 傳輸規範
  - 使用TPC/IP作為傳輸層協議
  - 使用HTTP、WebSocket作為應用層協議
  - 傳遞參數格式皆為json(須使用Content-type規範header)
  - 此接口清單遵循restful設計理念


# 接口說明
## HTTP接口清單
  - game-info(GET)-<a href="#game-info(GET)">取得遊戲資訊</a>
  - login-info(GET)-<a href="#login-info(GET)">取得玩家資訊</a>
  - apply-dealer-default-value(GET)-<a href="#apply-dealer-default-value(GET)">取得上莊預設值</a>
  - apply-dealer(PUT)-<a href="#apply-dealer(PUT)">玩家申請上莊</a>
  - who-is-the-dealer(GET)-<a href="#who-is-the-dealer(GET)">誰是莊家</a>
  - bet(PUT)-<a href="#bet(PUT)">創建注單</a>
  - result(GET)-<a href="#result(GET)">取得遊戲結果</a>
  - bet(GET)-<a href="#bet(GET)">取得注單紀錄</a>

## WS接口清單
  - result(WS)-<a href="#result(WS)">通知本局開獎結果</a>
  - chat-box(WS)-<a href="#chat-box(WS)">聊天室訊息</a>
  - serverTime(WS)-<a href="#serverTime(WS)">取得伺服器时间</a>
 
## 參數說明(<a href="#parametersTable">參數說明</a>) 

### <p id="game-info(GET)">game-info(GET)-取得遊戲資訊</p>
#### Reuqest

- Method: **GET**
- URL: ```/this-bar/inner-api/game-info/{roomId}```
- Headers： Content-Type:application/json
- Body:
```
{
 無進參
}
```

#### Response
- Body
```
{ 
	"retCode": "0",
	"data": {
		"gameNumber": "TB20180521163201"
	}
}
```


### <p id="login-info(GET)">login-info(GET)-取得玩家資訊</p>
#### Reuqest

- Method: **GET**
- URL: ```/this-bar/inner-api/login-info```
- Headers： Content-Type:application/json
- Body:
```
{
 無進參
}

```
#### Response
- Body
```
{ 
	"retCode": "0",
	"data": {
		"account": "GA220032"
		"balance": "500"
		"headerurl": "http://image/image.jpg"
		"name": "Sam"
	}
}
```

### <p id="apply-dealer-default-value(GET)">apply-dealer-default-value(GET)-取得上莊預設值</p>
#### Reuqest

- Method: **GET**
- URL: ```/this-bar/inner-api/login-info```
- Headers： Content-Type:application/json
- Body:
```
{
 無進參
}
```

#### Response
- Body
```
{ 
	"retCode": "0",
	"data": {
		"betReceiveTotal":25,"betReceiveSingle":[10,20,30,40],
		"betReceiveTotal":50,"betReceiveSingle":[20,40,60,80],
		"betReceiveTotal":75,"betReceiveSingle":[30,60,90,120],
		"betReceiveTotal":100,"betReceiveSingle":[40,80,120,160]
	}
}
```

### <p id="apply-dealer(PUT)">apply-dealer(PUT)-玩家申請上莊</p>
#### Reuqest

- Method: **PUT**
- URL: ```/this-bar/inner-api/apply-dealer```
- Headers： Content-Type:application/json
- Body:
```
{
 "gameNumber": "TB20180521163201"
 "betReceiveTotal": 10000000
 "betReceiveSingle": 100000
}
```

#### Response
- Body
```
{ 
	"retCode": "0",
}
```


### <p id="who-is-the-dealer(GET)">who-is-the-dealer(GET)-誰是莊家</p>
#### Reuqest

- Method: **GET**
- URL: ```/this-bar/inner-api/who-is-the-dealer```
- Headers： Content-Type:application/json
- Body:
```
{
 "gameNumber": "TB20180521163201"
}
```

#### Response
- Body
```
{ 
	"retCode": "0",
	"data": {
		"dealerAccount": "GA220032",
		"ifDealer": "true",
		"dealerHeadUrl": "http://image/image.jpg"
	}
}
```


### <p id="bet(PUT)">bet(PUT)-創建注單</p>
#### Reuqest

- Method: **PUT**
- URL: ```/this-bar/inner-api/bet```
- Headers： Content-Type:application/json
- Body:
```
{  
	"betResult" : {
			"betAmt": 5000
		},
	"gameNumber": "TB20180521163201"
}
```

#### Response
- Body
```
{
	"retCode": "0",
}
```





### <p id="result(GET)">result(GET)-取得遊戲結果</p>
#### Reuqest

- Method: **GET**
- URL: ```/this-bar/inner-api/result/{gameNumber}```
- Headers： Content-Type:application/json
- Body:
```
{
 無進參
}
```

#### Response
- Body
```
{
	"retCode": "0",
	"data": {
		"dealerCard": [wd,wd],
		"playerCard": [4-circle,4-circle],
		"payout": 3000
	}
}
```

### <p id="bet(POST)">bet(POST)-開牌</p>
#### Reuqest

- Method: **POST**
- URL: ```/this-bar/inner-api/bet```
- Headers： Content-Type:application/json
- Body:
```
{  
	"gameNumber": "TB20180521163201"
}
```

#### Response
- Body
```
{
	"retCode": "0"
}
```


### <p id="bet(GET)">bet(GET)-取得注單紀錄</p>
#### Reuqest

- Method: **GET**
- URL: ```/this-bar/inner-api/bet/{gameNumber} or {date}```
- Headers： Content-Type:application/json
- Body:
```
{
 無進參
}
```

#### Response
- Body
```
{
	"retCode": "0",
	"data": [{
			"gameNumber": "TB20180521163201",
			"betResult": [{
				"betNumber": "thisbar-20180521184522-100",
				"content": {
					"dealerCard": [
						"wd",
						"wd"
					],
					"playerCard": [
						"4-circle",
						"4-circle"
					]
				},
				"betTotal": 9000,
				"betAmt": 3000,
				"requestTime": "20180521184522",
				"earn": 4800
			}]
		},
		{
			"gameNumber": "TB20180521163301",
			"betResult": [{
				"betNumber": "thisbar-20180521184523-101",
				"content": {
					"dealerCard": [
						"9-circle",
						"9-circle"
					],
					"playerCard": [
						"4-circle",
						"2-circle"
					]
				},
				"betTotal": 9000,
				"betAmt": 3000,
				"requestTime": "20180521184523",
				"earn": 4800
			}]
		}
	]
}
```


### <p id="chat-box(WS)">chat-box(WS)-聊天室訊息</p>
#### Reuqest

- URL: ```/webSocket/thisBar/{account}```

```
	呼叫onopen方法
```

#### Response
```
{
	"type": "this-bar-{roomId}",
	"data": {
		"type": "chat-box"
		"content": "要打印到聊天室訊息"
	}
}
```


### <p id="result(WS)">result(WS)-通知本局開獎結果</p>
#### Reuqest

- URL: ```/webSocket/thisBar/{account}```

```
	呼叫onopen方法
```

#### Response
```
{
	"type": "this-bar-{roomId}",
	"data": {
		"type": "result"
		"gameResult": "TB20180521163201"
	}
}
```
### <p id="serverTime(WS)">serverTime(WS)-取得伺服器时间</p>
#### Reuqest

- URL: ```/webSocket/{gameType}/{account}```

```
	呼叫onopen方法
```

#### Response
```
{
	"type":"serverTime",
	"content":{
		"status": "SUCCESS"
		"serverTime": "20180625130602"
	}
}
```



## <p id="parametersTable">參數說明</p>
|參數名稱|參數名稱|參數格式||
|:--|:--|:--|:--|
|spId||String(32)|租用平台ID|
|lastGameNumber||String(32)|上局局號|
|lastRank||StringArray|上局結果|
|countDown||Integer(3)|倒數秒數|
|account||String(32)|玩家帳號|
|name||String(32)|玩家暱稱|
|balance||Integer(11)|玩家餘額(單位:cent)|
|headerUrl||String(128)|玩家頭像地址|
|gameNumber||String(32)|遊戲局號|
|date||String(17)|起訖日期(起日-迄日),ex:20180508-20180508|
|requestTime||String(14)|請求時間(yyyyMMddHHmmss)|
|betResult||JsonArray||
|dealerCard||String(16)|莊家手牌|
|playerCard||String(16)|玩家手牌|
||betNumber|String(24)|注單編號|
||type|String(16)|投注種類|
||content|String(16)|投注內容|
||betAmt|Integer(11)|投注金額(單位:cent)|
||earn(注單查詢)|Integer(11)|盈虧(含投入成本,可能為負)(單位:cent)|
|payout||Integer(11)|返回采金(必為正值)(單位:cent)|
|histroyResult：||JsonArray||
||type|String(16)|數據類別|
||content|String(32)|數據內容|


# 待更新項目

  - 將加上錯誤碼說明

# 更新日誌
----
 - 2018/04/30	創建文檔	by davidccc
 - 2018/05/02	修正金錢參數格式、比賽結果改為ArrayList	by davidccc
 - 2018/05/02	修改url pattern	by davidccc
 - 2018/05/03	新增WS接口		by davidccc
 - 2018/05/03	增加參數說明	by davidccc
 - 2018/05/08	修改GET接口訪問方式	by davidccc
 

# 元寶數據源系統接口文檔

# 文件目的
  - 本文檔介紹平台串接數據源接口參數規範、加密驗簽規則，並於文末提供各語言版本串接範例。


# 傳輸規範

  - 使用TCP/IP作為傳輸層協議
  - 使用HTTP作為應用層協議
  - 傳遞參數格式皆為json(須使用Content-type規範header)
  
  
# 安全規範

  - 所有接口必須校驗sign簽名值正確無誤,再處理業務邏輯


# 接口說明
## 元寶系統接口清單

  - bet-records/{language}-<a href="#bet-records/{language}(POST)">取得所有注單紀錄(POST)</a>
  - bet-records/{language}/{account}-<a href="#bet-records/{language}/{account}(POST)">取得單一會員注單紀錄(POST)</a>


## 參數說明(<a href="#parametersTable">參數說明</a>) 

### <p id="bet-records/{language}(POST)">bet-records/{language}-驗證會員(POST)</p>
#### Reuqest

- Method: **GET**
- URL: ```/login-info```
- Headers： Content-Type:application/json
- Body:
```
{
	"account": "PL0001",
	"requestTime": "20180625193012",
	"spId": "SP20180625052011",
	"sign": "c08d3e4cb641fbbdc5b06b448dd22395"
}
```

#### Response
- Body
```
{
	"retCode": "0",
	"data": {
		"count": 800,
		"sumAmt": 18000,
		"betResult": [{
				"betNumber": "20180103125646040b006",
				"content": {詳見注單內容對照表},
				"account": "GA205331acx",
				"requestTime": "20180103125623"
			},
			{
				"betNumber": "20180103125646040b007",
				"content": {詳見注單內容對照表},
				"account": "GA205331acx",
				"requestTime": "20180103125633"
			},
			{
				"betNumber": "20180103125646040b008",
				"content": {詳見注單內容對照表},
				"account": "GA205331acx",
				"requestTime": "20180103125633"
			}
		]
	}
}
```


### <p id="bet-records/{language}/{account}(POST)">bet-records/{language}/{account}(POST)-取得單一會員注單紀錄(POST)</p>
#### Reuqest

- Method: **POST**
- URL: ```/data-source/bet-records/{language}/{account}```
- Headers： Content-Type:application/json
- Body:
```
{
	"spId": "PL0001",
	"productId": "racing",
	"date": "20180501-20180504",
	"requestTime": "20180504163056",
	"sign": "c08d3e4cb641fbbdc5b06b448dd22395"
}
```

#### Response
- Body
```
{
	"retCode": "0",
	"data": {
		"count": 800,
		"sumAmt": 18000,
		"betResult": [{
				"betNumber": "20180103125646040b006",
				"content": {詳見注單內容對照表},
				"account": "GA205331acx",
				"requestTime": "20180103125623"
			},
			{
				"betNumber": "20180103125646040b007",
				"content": {詳見注單內容對照表},
				"account": "GA205331acx",
				"requestTime": "20180103125633"
			},
			{
				"betNumber": "20180103125646040b008",
				"content": {詳見注單內容對照表},
				"account": "GA205331acx",
				"requestTime": "20180103125633"
			}
		]
	}
}
```


## <p id="parametersTable">參數說明</p>
|參數名稱|參數名稱|參數格式|參數說明|
|:--|:--|:--|:--|
|language||String(16)|返回注單內容語言(有以下枚舉值:en、zh-cn、zh-tw)|
|spId||String(32)|平台ID(由元寶系統發配)|
|account||String(32)|玩家帳號|
|type||String(16)|遊戲種類(詳見<a href="#productTable">產品對應表</a>,或傳入all查詢所有)|
|date||String(17)|查詢起迄日(缺省值為當日)|
|requestTime||String(14)|請求時間(yyyyMMddHHmmss)|
|sign||String(32)|簽名(詳見<a href="#signDirection">簽名機制說明)</a>|
|count||Integer(11)|總注單數|
|sumAmt||Integer(11)|總碼量(單位:分)|
|betResult||JsonArray||
||betNumber|String(32)|注單編號|
||content|JsonObject|投注內容(詳見<a href="#betResultTable">注單內容對照表</a>)|


## <p id="productTable">產品對照表</p>
|產品ID(productId)|遊戲名稱|
|:--|:--|
|racing|北京賽車|
|rowing|幸運飛艇|
|timetime|重慶時時彩|
|cowcow|對戰牛牛|

## <p id="betResultTable">注單內容對照表</p>
|產品ID(productId)|參數名稱|參數格式|參數說明|
|:--|:--|:--|:--|
|racing、rowing、timetime||||
||type|String(16)|下注種類|
||content|String(16)|下注內容|
||amt|Integer(11)|下注金額(單位:分)|
||earn|Integer(11)|輸贏(正值為玩家贏、負值為玩家輸)(單位:分)||
|cowcow||||
||role|String(8)|閒家/莊家|
||cards|String(32)|取得牌組|
||point|String(16)|最佳牌型|
||amt|Integer(11)|下注金額/收注總額(單位:分)|
||commission|Integer(11)|抽水(單位:分)|


## <p id="signDirection">簽名機制說明</p>


# 待更新項目

 - 須加上簽名演算範例
 - 須補全局錯誤碼
 

# 更新日誌

 - 2018/05/04	建立文檔	by davidccc
 - 2018/05/17	產品ID修正	by davidccc

# 附錄：

 - <a href="https://github.com/TorchStoneRD/yuanbao-demo">文檔與DEMO包</a>
